# BoxGame渲染器交互功能说明

## 🎮 功能概述

### 2D视图交互
- **交互方式**: 鼠标拖拽缩放，点击选择
- **适用场景**: 游戏区域和2D压力分布观察
- **特点**: 实时传感器数据更新时保持交互性

### 3D视图交互
- **交互方式**: 鼠标拖拽旋转视角，滚轮缩放
- **适用场景**: 3D压力分布热力图观察
- **特点**: 实时传感器数据更新时保持交互性

### 重置视图
- **快捷键**: 按 `R` 键
- **功能**: 将所有视图重置到最佳观察位置
- **适用场景**: 视角混乱时快速恢复

## 🔧 技术实现

### 2D视图交互机制
BoxGame渲染器使用PyQtGraph的ViewBox组件实现2D交互：

1. **鼠标模式设置**: `setMouseMode(view_box.RectMode)`
   - 启用矩形选择模式
   - 支持拖拽缩放操作

2. **鼠标交互启用**: `setMouseEnabled(x=True, y=True)`
   - 启用X轴和Y轴的鼠标交互
   - 允许视图范围变化

3. **状态保护**: 在每次数据更新时确保交互性
   - 检查并重新启用被禁用的鼠标交互
   - 维持用户的缩放和移动设置

### 3D视图相机控制优化
BoxGame渲染器使用PyQtGraph的GLViewWidget实现3D交互：

1. **首次创建**: 只在3D表面首次创建时设置相机位置
   - 距离: 120单位
   - 仰角: 30度
   - 方位角: 45度
   - 中心点: (31.5, 31.5, 0)

2. **数据更新**: 后续帧只更新表面数据，不触碰相机
   - 保持用户设置的视角
   - 实时更新压力数据
   - 维持交互性

3. **模式切换**: 切换到3D模式时强制重建
   - 重置surface_item为None
   - 重新应用相机设置
   - 确保正确的初始状态

### 🛡️ 稳定性保障
为了解决传感器连接后交互失效的问题：

1. **2D视图保护**: 实时检查和重新启用鼠标交互
2. **3D视图保护**: 逻辑分离相机设置与数据更新
3. **状态保护**: 只在必要时重置视图位置
4. **模式切换**: 正确处理2D/3D模式切换
5. **重置功能**: 提供R键快速重置到最佳视角

### 视图范围优化
- **2D视图**: 用户可自由控制缩放和移动
- **3D视图**: 用户可自由控制视角和缩放
- **游戏区域**: 支持完整的交互操作

## 📊 功能特点

### 实时监控
- 2D和3D视图都支持实时交互，不受数据更新影响
- 完整显示所有传感器数据点
- 保持用户的视角设置

### 多视图支持
- **游戏区域**: 支持拖拽缩放和点击交互
- **2D压力视图**: 支持拖拽缩放的压力分布热力图
- **3D压力视图**: 支持自由交互的3D压力分布

### 性能优化
- 2D视图使用高效的ViewBox交互
- 3D视图只在必要时重建
- 数据更新不影响用户交互
- 支持传感器连接后的持续稳定交互

### 🛡️ 稳定性保障
- **传感器兼容**: 专门解决传感器连接后交互失效的问题
- **自动恢复**: 交互被意外禁用时自动重新启用
- **持续监控**: 确保交互在数据更新时保持稳定

## 🎯 使用建议

1. **2D观察**: 使用拖拽缩放查看游戏区域和2D压力分布的细节
2. **3D观察**: 使用3D视图观察压力分布的立体效果
3. **快速恢复**: 使用R键快速重置到最佳视角
4. **模式切换**: 使用H键在2D/3D热力图模式间切换
5. **全屏体验**: 使用F11键切换全屏模式获得更好的观察体验

## 🔍 故障排除

### 2D视图无法交互
1. 检查控制台是否有"鼠标事件已设置: 支持拖拽缩放"的消息
2. 按R键重置到最佳视角
3. 观察控制台是否有"重新启用鼠标交互"的消息

### 3D视图无法交互
1. 检查控制台是否有"3D表面已创建，相机已设置"的消息
2. 按R键重置到最佳视角
3. 使用H键切换到2D模式，再切换回3D模式
4. 观察控制台是否有"3D相机位置已重置"的消息

### 传感器连接后交互失效
1. 这是已知问题，已通过多层保护机制解决
2. 如果仍然失效，检查控制台输出
3. 等待2秒，系统会自动尝试恢复
4. 手动按R键重置视图

### 性能问题
1. 交互功能已优化，不影响实时渲染
2. 在需要时使用R键重置视图
3. 观察控制台输出的性能信息

## 📝 更新日志

- **v1.0**: 初始实现拖拽缩放功能
- **v1.1**: 添加视图范围限制和边界保护
- **v1.2**: 优化性能，支持传感器连接后的缩放操作
- **v1.3**: 添加鼠标交互保护机制，彻底解决传感器连接后缩放失效问题
- **v2.0**: 改为45度倾斜显示完整区域，禁用缩放功能
- **v2.1**: 修复3D视图在传感器连接后无法交互的问题，实现真正的3D交互功能
- **v2.2**: 完整实现2D和3D视图的交互功能，支持传感器连接后的持续稳定交互 