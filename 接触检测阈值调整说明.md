# 接触检测阈值调整说明

## 📊 概述

接触检测是推箱子游戏的核心功能，它决定了系统何时识别用户的手指接触。通过调整接触检测阈值，您可以优化系统的响应性和准确性。

## 🎯 当前设置

- **压力阈值**: `0.003` (从 `0.005` 调整而来，提高灵敏度)
- **接触面积阈值**: `3` (像素点数量)
- **滑动阈值**: `0.08`
- **梯度阈值**: `1e-4`

## 🔧 调整方法

### 1. 实时调整阈值

```python
# 设置压力阈值和接触面积阈值
game_core.set_contact_detection_thresholds(
    pressure_threshold=0.002,      # 压力阈值
    contact_area_threshold=3       # 接触面积阈值
)
```

### 2. 获取当前配置

```python
# 获取当前接触检测配置
config_info = game_core.get_contact_detection_info()
print(f"压力阈值: {config_info['pressure_threshold']}")
print(f"接触面积阈值: {config_info['contact_area_threshold']}")
```

### 3. 测试灵敏度

```python
# 使用当前压力数据测试不同阈值的灵敏度
test_results = game_core.test_contact_sensitivity(pressure_data)
```

## 📈 阈值配置建议

### 高灵敏度配置
```python
game_core.set_contact_detection_thresholds(
    pressure_threshold=0.001,      # 很低
    contact_area_threshold=2       # 很小
)
```
**适用场景**: 需要检测非常轻微的接触
**风险**: 可能产生误判

### 中等灵敏度配置 (推荐)
```python
game_core.set_contact_detection_thresholds(
    pressure_threshold=0.003,      # 适中
    contact_area_threshold=3       # 适中
)
```
**适用场景**: 一般使用，平衡敏感度和稳定性

### 低灵敏度配置
```python
game_core.set_contact_detection_thresholds(
    pressure_threshold=0.005,      # 较高
    contact_area_threshold=4       # 较大
)
```
**适用场景**: 需要稳定的接触检测，避免误判

### 很低的灵敏度配置
```python
game_core.set_contact_detection_thresholds(
    pressure_threshold=0.008,      # 很高
    contact_area_threshold=5       # 很大
)
```
**适用场景**: 只检测明显的接触，忽略轻微接触

## 🔍 检测逻辑详解

### 接触检测流程

1. **压力阈值检查**: 检查最大压力是否超过阈值
   ```python
   if max_pressure < self.pressure_threshold:
       return False  # 压力过低
   ```

2. **接触面积检查**: 检查超过阈值的像素点数量
   ```python
   contact_mask = pressure_data > self.pressure_threshold
   contact_area = np.sum(contact_mask)
   if contact_area < self.contact_area_threshold:
       return False  # 接触面积过小
   ```

3. **接触确认**: 两个条件都满足时确认接触
   ```python
   return True  # 接触检测成功
   ```

### 调试信息

系统会输出详细的调试信息：
```
🔍 接触检测: 压力过低 - 最大压力=0.001234, 阈值=0.003000
🔍 接触检测: 面积过小 - 接触面积=2, 阈值=3
✅ 接触检测成功: 最大压力=0.004567, 平均压力=0.002345, 接触面积=15
```

## 🎮 实际应用建议

### 场景1：手指轻触
如果用户习惯轻触传感器：
```python
game_core.set_contact_detection_thresholds(0.002, 2)
```

### 场景2：手指重压
如果用户习惯重压传感器：
```python
game_core.set_contact_detection_thresholds(0.005, 4)
```

### 场景3：环境噪声较大
如果传感器环境噪声较大：
```python
game_core.set_contact_detection_thresholds(0.004, 5)
```

### 场景4：高精度控制
如果需要高精度的接触控制：
```python
game_core.set_contact_detection_thresholds(0.001, 1)
```

## 🚀 快速测试

运行测试脚本查看效果：
```bash
python test_contact_threshold.py
```

该脚本会：
1. 生成不同强度的测试数据
2. 测试不同阈值配置的效果
3. 提供灵敏度分析报告
4. 给出优化建议

## 💡 优化技巧

### 1. 逐步调整
不要一次性大幅调整阈值，建议：
- 每次调整幅度不超过50%
- 观察调整后的效果
- 根据实际使用情况微调

### 2. 监控调试信息
关注控制台输出的调试信息：
- 压力过低：需要降低压力阈值
- 面积过小：需要降低面积阈值
- 频繁误判：需要提高阈值

### 3. 环境适应
不同环境可能需要不同设置：
- 温度变化可能影响传感器灵敏度
- 湿度变化可能影响接触检测
- 传感器老化可能需要调整阈值

### 4. 用户习惯
考虑用户的使用习惯：
- 轻触用户：使用低阈值
- 重压用户：使用高阈值
- 混合使用：使用中等阈值

## ⚠️ 注意事项

1. **阈值过低**: 可能导致误判，系统过于敏感
2. **阈值过高**: 可能漏检，系统响应迟钝
3. **面积阈值**: 影响接触检测的稳定性
4. **实时调整**: 可以在运行时调整，但建议在测试阶段确定最佳值

## 🔧 故障排除

### 问题1：接触检测不灵敏
**解决方案**: 降低压力阈值
```python
game_core.set_contact_detection_thresholds(0.002, 3)
```

### 问题2：频繁误判
**解决方案**: 提高压力阈值或面积阈值
```python
game_core.set_contact_detection_thresholds(0.005, 4)
```

### 问题3：接触检测不稳定
**解决方案**: 增加面积阈值
```python
game_core.set_contact_detection_thresholds(0.003, 5)
```

### 问题4：需要更精确的控制
**解决方案**: 使用自适应阈值
```python
# 根据当前压力数据动态调整
max_pressure = np.max(current_pressure_data)
adaptive_threshold = max_pressure * 0.3  # 使用30%作为阈值
game_core.set_contact_detection_thresholds(adaptive_threshold, 3)
``` 