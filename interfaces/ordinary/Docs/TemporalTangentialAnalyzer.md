好的，我们来分析这个文件。这个文件是您项目中一个非常关键和高级的模块，它负责将单帧的分析结果提升到时间维度进行综合判断。

---

### 文件名推测: `TemporalTangentialAnalyzer.py`

#### 核心功能总结

这个文件包含了两个紧密关联的类：`TemporalTangentialAnalyzer` 和 `TemporalVisualizationDialog`。

1.  **`TemporalTangentialAnalyzer` (时序分析器)**:
    这是一个**纯逻辑、无界面的核心分析类**。它的主要作用是接收一系列**连续的、单帧的**切向力分析结果，然后通过综合这些结果在**时间维度上的表现**，计算出一个**更平滑、更稳定、更可靠的“共识角度”**。它像一个经验丰富的裁判，不只看运动员某一瞬间的表现，而是观察其一段时间内的稳定发挥后才给出最终分数。

2.  **`TemporalVisualizationDialog` (时序可视化对话框)**:
    这是一个**独立的PyQt5弹窗界面**。它的唯一功能就是**将 `TemporalTangentialAnalyzer` 的所有内部工作状态和历史数据，以图表的形式实时地、深度地可视化出来**。它是一个为开发者和研究人员设计的强大调试工具。

---

#### `TemporalTangentialAnalyzer` 详细功能分析

这个类的设计思想是，任何单一帧的分析结果都可能因为噪声或数据突变而不稳定，但通过观察一段时间内的趋势，可以得到更可信的结论。

* **历史数据存储**:
    * 它使用多个 `deque` (双端队列) 数据结构来高效地存储每个分析方法在过去 `window_size` 帧内的**角度历史**和**置信度历史**。

* **智能重置机制 (`check_cop_movement`)**:
    * 这是一个非常智能的设计。它会持续监控压力中心（CoP）的位置。如果检测到CoP发生了大幅度的、快速的移动（超过预设阈值），它就会判断这是一个新的、独立的触摸动作的开始。
    * 此时，它会**自动调用 `reset_temporal_data()` 清空所有历史数据**，避免之前旧动作的数据干扰对新动作的分析。

* **时序可靠性评估 (`calculate_temporal_reliability`)**:
    * 这是该分析器最核心、最先进的功能之一。对于系统中的每一种算法（如Gabor、形状矩等），它不再只看其当前帧的置信度，而是会回顾其历史表现，从三个维度为其计算一个**“时序可靠性”分数**：
        1.  **角度一致性**: 在历史窗口内，这个算法给出的角度结果是否稳定，跳动大不大？
        2.  **置信度稳定性**: 它的置信度读数是否持续偏高且稳定？
        3.  **帧间连续性**: 相邻两帧之间，它给出的角度变化是否平滑，有没有剧烈的突变？
    * 一个算法只有在这三方面都表现良好，才会被认为是“时序可靠”的。

* **指数平滑 (`temporal_smooth_angle`)**:
    * 对每种方法的角度输出，使用指数移动平均（EMA）进行平滑处理，有效滤除高频抖动。它还特别处理了角度从359°跳变到0°这类周期性问题。

* **加权共识决策 (`get_temporal_consensus`)**:
    * 这是最终的决策过程。它将每个算法**当前的置信度**和刚刚计算出的**时序可靠性**进行加权组合，得到一个**“综合权重”**。
    * 然后，它只采纳那些综合权重达标的“可靠专家”的意见，对它们的（平滑后的）角度进行最终的加权平均，从而得出全局的**时序共识角度**和**整体置信度**。

---

#### `TemporalVisualizationDialog` 详细功能分析

这个对话框是`TemporalTangentialAnalyzer`的“配套仪表盘”，它让所有复杂的内部计算过程变得透明可见。

* **五大核心图表**:
    1.  **角度时序图**: 主图表，用曲线图展示了所有独立算法的角度历史、以及最终的黑色“共识角度”曲线，可以直观地看出共识结果是如何从众多方法中得出的。
    2.  **置信度热力图**: 一个二维图表，行是算法，列是时间。单元格的颜色深浅代表了该算法在某一时刻的置信度高低。可以快速发现哪些算法在持续“发热”（高置信度）。
    3.  **可靠性柱状图**: 用柱状图清晰地对比当前各个算法的“时序可靠性”分数。
    4.  **共识历史图**和**统计信息**: 单独展示共识角度的稳定性，并用文字给出摘要统计。
* **实时交互**: 用户可以**暂停/继续**图表的实时刷新，**手动刷新**，或**调整刷新频率**，为调试和分析提供了极大的便利。

#### 在项目中的角色

`TemporalTangentialAnalyzer` 在整个项目的数据流中，扮演着**“精加工”**和**“高级顾问”**的角色。它位于单帧分析器（如 `HighPerformanceTangentialForceAnalyzer`）之后，负责将原始、粗糙、可能带有抖动的分析结果，提炼成一个平滑、稳定、可靠的最终输出，极大地提升了整个系统的性能和可用性，是实现精确动态交互（如推箱子）的关键环节。