# 设置界面使用说明

## 🎯 概述

现在您可以通过图形界面来调整接触检测参数，无需修改代码！设置界面提供了直观的参数控制，让您能够轻松调整接触检测的灵敏度和可视化效果。

## 🔧 如何打开设置界面

1. **启动游戏**: 运行 `python box_game_app_optimized.py`
2. **点击设置按钮**: 在控制面板中找到"⚙️ 设置"按钮并点击
3. **调整参数**: 在弹出的设置对话框中调整参数
4. **应用设置**: 点击"确定"按钮应用设置

## 📊 接触检测参数说明

### 🔍 压力阈值 (Pressure Threshold)
- **范围**: 0.0001 - 0.01
- **默认值**: 0.002
- **作用**: 控制检测接触所需的最小压力值
- **调整建议**:
  - `0.0001-0.002`: 极高/高灵敏度，适合轻微接触
  - `0.002-0.005`: 中等灵敏度，平衡敏感度和稳定性
  - `0.005-0.01`: 低灵敏度，适合稳定的接触检测

### 🔍 接触面积阈值 (Contact Area Threshold)
- **范围**: 1 - 20 像素
- **默认值**: 2
- **作用**: 控制检测接触所需的最小接触面积
- **调整建议**:
  - `1-3`: 高灵敏度，适合点接触
  - `3-5`: 中等灵敏度，适合一般接触
  - `5-20`: 低灵敏度，适合大面积接触

## 🎨 可视化参数说明

### 🎨 颜色范围控制
- **颜色范围最小值**: 控制压力热力图的最小颜色值
- **颜色范围最大值**: 控制压力热力图的最大颜色值
- **作用**: 同时影响2D和3D热力图的颜色显示范围
- **调整建议**:
  - 较小的范围（如0.0-0.005）: 提高颜色对比度，适合观察细节
  - 较大的范围（如0.0-0.02）: 显示更大范围的压力变化
  - 根据实际压力数据调整，确保重要信息在颜色范围内

### 🎨 3D渲染选项
- **启用3D光照**: 为3D热力图添加光照效果
- **启用3D阴影**: 为3D热力图添加阴影效果
- **启用3D动画**: 为3D热力图添加自动旋转动画
- **旋转速度**: 控制3D动画的旋转速度
- **仰角/方位角**: 控制3D视角
- **表面透明度**: 控制3D表面的透明度
- **启用线框**: 显示3D网格线框
- **启用抗锯齿**: 提高3D渲染质量
- **启用泛光效果**: 为高亮区域添加发光效果

### 🎨 数据预处理选项
- **启用数据预处理**: 总开关，控制是否进行数据预处理
- **高斯模糊**: 对压力数据进行平滑处理
- **模糊强度 (σ)**: 控制高斯模糊的强度
- **坐标轴交换**: 交换X/Y轴方向
- **自定义颜色映射**: 使用自定义的颜色方案

## 🎯 便捷灵敏度预设

设置界面提供了5个预设选项，让您快速调整灵敏度：

| 预设名称 | 压力阈值 | 面积阈值 | 适用场景 |
|---------|---------|---------|---------|
| 极高灵敏度 | 0.001 | 1 | 检测非常轻微的接触 |
| 高灵敏度 | 0.002 | 2 | 检测轻微接触（推荐） |
| 中等灵敏度 | 0.003 | 3 | 一般使用 |
| 低灵敏度 | 0.005 | 4 | 稳定的接触检测 |
| 很低灵敏度 | 0.008 | 5 | 避免误判 |

## 🔧 解决"按压了但显示没有按压"的问题

### 方法1: 使用便捷预设
1. 打开设置界面
2. 在"灵敏度预设"下拉菜单中选择"极高灵敏度"
3. 点击"确定"应用设置

### 方法2: 手动调整
1. 打开设置界面
2. 将"压力阈值"调整为 `0.001` 或更低
3. 将"接触面积阈值"调整为 `1`
4. 点击"确定"应用设置

### 方法3: 逐步调整
1. 先尝试"高灵敏度"预设
2. 如果仍然无法检测到，选择"极高灵敏度"
3. 如果检测过于敏感，可以适当提高阈值

## 🎨 优化可视化效果

### 调整颜色范围
1. 打开设置界面
2. 在"数据预处理参数"组中调整"颜色范围最小值"和"颜色范围最大值"
3. 这些设置会同时影响2D和3D热力图
4. 根据实际压力数据调整，确保重要信息在颜色范围内

### 3D热力图优化
1. 在"3D渲染选项"组中调整各种参数
2. 启用"3D光照"和"3D阴影"提高视觉效果
3. 调整"表面透明度"和"线框"选项
4. 使用"仰角"和"方位角"调整最佳视角

### 数据预处理优化
1. 在"数据预处理参数"组中调整预处理选项
2. 启用"高斯模糊"并调整"模糊强度"来平滑数据
3. 根据需要启用"坐标轴交换"
4. 启用"自定义颜色映射"使用优化的颜色方案

## ⚠️ 注意事项

### 阈值过低的问题
- **误判**: 可能将环境噪声误判为接触
- **不稳定**: 接触检测可能不稳定
- **建议**: 从高灵敏度开始，逐步调整到最佳状态

### 阈值过高的问题
- **漏检**: 可能错过轻微的接触
- **延迟**: 需要更大的按压力度才能触发
- **建议**: 如果经常漏检，适当降低阈值

### 颜色范围设置
- **范围过小**: 可能导致颜色对比度不足
- **范围过大**: 可能导致细节丢失
- **建议**: 根据实际压力数据动态调整

## 🧪 测试和验证

### 实时测试
1. 调整参数后，立即测试接触检测效果
2. 观察控制台输出的调试信息
3. 根据实际效果进一步微调

### 使用测试脚本
```bash
# 测试设置界面功能
python test_settings_interface.py

# 测试3D热力图颜色范围
python test_3d_color_range.py

# 测试接触检测灵敏度
python test_contact_threshold.py

# 快速修复接触检测问题
python fix_contact_detection.py
```

## 📋 参数配置示例

### 示例1: 手指轻触
```python
pressure_threshold = 0.001
contact_area_threshold = 1
color_range = [0.0, 0.005]
```

### 示例2: 正常按压
```python
pressure_threshold = 0.002
contact_area_threshold = 2
color_range = [0.0, 0.01]
```

### 示例3: 重压
```python
pressure_threshold = 0.003
contact_area_threshold = 3
color_range = [0.0, 0.015]
```

### 示例4: 环境噪声较大
```python
pressure_threshold = 0.005
contact_area_threshold = 4
color_range = [0.001, 0.02]
```

## 🔄 参数持久化

设置界面会自动保存您的参数设置，下次启动游戏时会自动加载上次的设置。

## 🆘 故障排除

### 问题1: 设置界面无法打开
- 检查是否正确导入了相关模块
- 确保PyQt5已正确安装

### 问题2: 参数调整后没有效果
- 确保点击了"确定"按钮
- 检查控制台是否有错误信息
- 重新启动游戏以应用新设置

### 问题3: 接触检测仍然不灵敏
- 尝试使用"极高灵敏度"预设
- 检查传感器是否正常工作
- 确认按压位置是否正确

### 问题4: 3D热力图颜色范围不正确
- 检查"颜色范围最小值"和"颜色范围最大值"设置
- 确保设置的范围包含实际压力数据
- 运行 `python test_3d_color_range.py` 测试功能

## 💡 最佳实践

1. **从预设开始**: 先尝试预设选项，再根据需要微调
2. **逐步调整**: 每次调整幅度不要太大
3. **实时测试**: 调整后立即测试效果
4. **记录配置**: 找到最佳配置后记录下来
5. **环境适应**: 不同环境下可能需要不同的配置
6. **颜色范围优化**: 根据实际压力数据调整颜色范围
7. **3D效果调优**: 根据个人喜好调整3D渲染效果

## 📞 技术支持

如果遇到问题，请：
1. 查看控制台输出的错误信息
2. 运行测试脚本检查功能
3. 检查相关文档和示例
4. 联系技术支持团队

---

**祝您使用愉快！** 🎮 